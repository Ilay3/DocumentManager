
@model PrintHtmlViewModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Печать документа";
}

<style>
  /* ===========================
     1) Скрываем скроллбар на экране
     =========================== */
  .document-content {
    /* всё ещё прокручивается колесом и тачпадом, но полоса не рисуется */
    overflow-y: auto;
    -ms-overflow-style: none;    /* IE/Edge */
    scrollbar-width: none;       /* Firefox */
  }
  .document-content::-webkit-scrollbar {
    width: 0 !important;
    height: 0 !important;
    background: transparent !important;
  }

  /* ===========================
     2) Правим поведение при печати
     =========================== */
  @@media print {
    /* 2.1 Скрываем всё, что не нужно */
    .print-panel, .navbar, .sidebar, .footer, .layout-header, .layout-footer {
      display: none !important;
    }

    /* 2.2 Говорим контейнеру занять всю ширину */
    .container-fluid.px-0,
    .content-wrapper,   /* если у вас есть обёртка из _Layout */
    .wrapper {
      margin: 0 !important;
      padding: 0 !important;
      width: 100% !important;
    }

    /* 2.3 Принудительно разворачиваем колонку контента на 100% */
    .row.g-0 {
      display: block !important;
    }
    .row.g-0 > .col-md-3 {
      display: none !important;  /* убираем панель */
    }
    .row.g-0 > .col-md-9 {
      display: block !important;
      width: 100% !important;
      float: none !important;
    }

    /* 2.4 Очищаем фон и тени */
    body, .document-content {
      margin: 0; padding: 0;
      background: none !important;
      box-shadow: none !important;
      overflow: visible !important;
    }
  }
</style>

<div class="container-fluid px-0">
    <div class="row g-0">
        <!-- Панель управления печатью (видима только в браузере) -->
        <div class="col-md-3 print-panel d-print-none" style="height: 100vh; overflow-y: auto; background-color: #f8f9fa; border-right: 1px solid #dee2e6; padding: 20px;">
            <div class="d-flex align-items-center mb-4">
                <i class="bi bi-printer fs-3 text-primary me-2"></i>
                <h4 class="mb-0">Печать документа</h4>
            </div>

            <div class="document-info mb-4">
                <h5>Информация о документе</h5>
                <div class="card">
                    <div class="card-body">
                        <dl class="mb-0">
                            <dt>Наименование</dt>
                            <dd>@Model.DocumentName</dd>
                            <dt>Заводской номер</dt>
                            <dd>@Model.FactoryNumber</dd>
                            <dt>Создан</dt>
                            <dd>@Model.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</dd>
                            <dt>Автор</dt>
                            <dd>@Model.CreatedBy</dd>
                        </dl>
                    </div>
                </div>
            </div>
            <div class="print-actions mb-4">
                <h5>Действия</h5>
                <div class="d-grid gap-2">
                    <button id="printBtn" class="btn btn-primary">
                        <i class="bi bi-printer"></i> Печать документа
                    </button>
                    <a href="@Url.Action("Download", "Documents", new { id = Model.DocumentId })" class="btn btn-outline-secondary">
                        <i class="bi bi-download"></i> Скачать документ
                    </a>
                    <a href="@Url.Action("Details", "Documents", new { id = Model.DocumentId })" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left"></i> Вернуться к документу
                    </a>
                </div>
            </div>
        </div>


        <!-- Содержимое документа -->
        <div class="col-md-9 document-content" style="height: calc(100vh - 56px); overflow-y: auto; padding: 20px;">
            <div id="documentHtml">
                @Html.Raw(Model.HtmlContent)
            </div>
        </div>
    </div>
</div>

@section Scripts {
  <script>
    document.getElementById('printBtn')?.addEventListener('click', () => window.print());
    window.addEventListener('load', () => {
      if (new URLSearchParams(location.search).get('print') === 'true') {
        window.print();
      }
    });
  </script>
}
